:root {
    --primary-color: #ff9eb5;
    --secondary-color: #a0c4ff;
    --bg-color: #fff0f5;
    --card-bg: #fff;
    --text-color: #555
}

[data-theme=sky] {
    --primary-color: #4facfe;
    --secondary-color: #f6d365;
    --bg-color: #e0f2f1;
    --card-bg: #fff
}

[data-theme=mint] {
    --primary-color: #00b894;
    --secondary-color: #fdcb6e;
    --bg-color: #f0fdf4;
    --card-bg: #fff
}

[data-theme=dark] {
    --primary-color: #bb86fc;
    --secondary-color: #03dac6;
    --bg-color: #121212;
    --card-bg: #1e1e1e;
    --text-color: #e0e0e0
}

[data-theme=lemon] {
    --primary-color: #f9ca24;
    --secondary-color: #f0932b;
    --bg-color: #fffde7;
    --card-bg: #fff
}

[data-theme=grape] {
    --primary-color: #6c5ce7;
    --secondary-color: #a29bfe;
    --bg-color: #f3e5f5;
    --card-bg: #fff
}

[data-theme=peach] {
    --primary-color: #ff7675;
    --secondary-color: #fab1a0;
    --bg-color: #fff0e6;
    --card-bg: #fff
}

[data-theme=ocean] {
    --primary-color: #0984e3;
    --secondary-color: #74b9ff;
    --bg-color: #e3f2fd;
    --card-bg: #fff
}

[data-theme=forest] {
    --primary-color: #218c74;
    --secondary-color: #33d9b2;
    --bg-color: #e8f5e9;
    --card-bg: #fff
}

[data-theme=coffee] {
    --primary-color: #cd6133;
    --secondary-color: #d35400;
    --bg-color: #fbeee6;
    --card-bg: #fff
}

[data-theme=cyber] {
    --primary-color: #f05;
    --secondary-color: #0fc;
    --bg-color: #050510;
    --card-bg: #101020;
    --text-color: #0fc
}

[data-theme=mono] {
    --primary-color: #2d3436;
    --secondary-color: #636e72;
    --bg-color: #f5f6fa;
    --card-bg: #fff
}

body {
    background-color: var(--bg-color);
    font-family: Fredoka,Noto Sans SC,sans-serif;
    color: var(--text-color);
    transition: background-color .3s,color .3s;
    display: flex;
    flex-direction: column;
    min-height: 100vh
}

.navbar {
    background-color: var(--card-bg);
    box-shadow: 0 4px 15px rgba(0,0,0,.1);
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    transition: background-color .3s
}

.navbar-brand {
    font-weight: 700;
    color: var(--primary-color)!important;
    font-size: 1.5rem
}

.acg-card {
    background: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 8px 20px rgba(0,0,0,.05);
    border: 2px solid hsla(0,0%,100%,.1);
    transition: transform .2s,background-color .3s;
    margin-bottom: 20px;
    overflow: hidden
}

.acg-header {
    background: linear-gradient(90deg,var(--secondary-color),var(--primary-color));
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center
}

.acg-header,.btn-acg {
    color: #fff;
    font-weight: 600
}

.btn-acg {
    background-color: var(--primary-color);
    border: none;
    border-radius: 50px;
    padding: 10px 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,.1);
    transition: all .3s
}

.btn-acg:hover {
    background-color: var(--secondary-color);
    transform: scale(1.05);
    color: #fff
}

#drop-zone {
    border: 3px dashed var(--secondary-color);
    border-radius: var(--border-radius);
    background-color: hsla(0,0%,50%,.05);
    transition: all .3s;
    cursor: pointer;
    min-height: 250px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center
}

#drop-zone.dragover {
    border-color: var(--primary-color);
    background-color: rgba(var(--primary-color),.1)
}

.img-container {
    max-height: 60vh;
    width: 100%;
    background-color: #333;
    border-radius: var(--border-radius);
    overflow: hidden
}

.cropper-view-box {
    display: block;
    overflow: hidden;
    outline: none!important;
    --line-w: 1px;
    --grid-w: 25%;
    --grid-h: 25%;
    --c: #fff
}

.cropper-view-box:after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity .2s;
    z-index: 3;
    box-shadow: inset 0 0 0 var(--line-w) var(--c);
    background-image: linear-gradient(90deg,var(--c) var(--line-w),transparent var(--line-w)),linear-gradient(180deg,var(--c) var(--line-w),transparent var(--line-w));
    background-size: var(--grid-w) var(--grid-h);
    background-position: 0 0
}

.cropper-view-box.show-grid:after {
    opacity: 1
}

.slice-card {
    background: var(--card-bg);
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,.05);
    text-align: center;
    transition: all .2s;
    position: relative;
    cursor: pointer
}

.slice-card.selected {
    border-color: var(--primary-color);
    background-color: rgba(var(--primary-color),.05);
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,.1)
}

.slice-card .check-mark {
    position: absolute;
    top: 5px;
    left: 5px;
    width: 20px;
    height: 20px;
    background: var(--primary-color);
    color: #fff;
    border-radius: 50%;
    font-size: 12px;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1
}

.slice-card.selected .check-mark {
    display: flex
}

.slice-img-wrapper {
    overflow: hidden;
    border-radius: 8px;
    margin-bottom: 8px;
    position: relative
}

.slice-card img {
    max-width: 100%;
    height: auto;
    background-image: url('data:image/svg+xml;utf8,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="10" height="10" fill="%23eee"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>');
    transition: transform .3s ease
}

.slice-card input {
    font-size: .8rem;
    text-align: center;
    border: 1px solid rgba(0,0,0,.1);
    border-radius: 6px;
    background: var(--bg-color);
    color: var(--text-color);
    width: 100%
}

#slicePreviewImgContainer:hover img,.slice-img-wrapper:hover img {
    transform: scale(1.5)
}

#previewGrid {
    display: grid;
    gap: 10px;
    width: 100%
}

#previewGrid>.col {
    width: auto!important;
    flex: none
}

.info-icon {
    position: relative;
    cursor: help
}

.info-tooltip {
    visibility: hidden;
    width: 200px;
    background-color: rgba(0,0,0,.8);
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 4;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity .3s;
    font-size: .75rem;
    font-weight: 400;
    line-height: 1.2;
    pointer-events: none
}

.info-tooltip:after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: 5px;
    border-width: 5px;
    border-style: solid;
    border-color: rgba(0,0,0,.8) transparent transparent
}

.info-icon:hover .info-tooltip {
    visibility: visible;
    opacity: 1
}

.preset-grid {
    cursor: pointer;
    transition: background-color .2s
}

.preset-grid:hover {
    background-color: var(--primary-color)!important
}

.nudge-tools {
    display: flex;
    flex-direction: row;
    justify-content: center;
    gap: 2px;
    margin-bottom: 5px;
    opacity: 0;
    transition: .2s
}

.slice-card:hover .nudge-tools {
    opacity: 1
}

.btn-nudge {
    width: 20px;
    height: 20px;
    padding: 0;
    font-size: 10px;
    line-height: 1;
    border-radius: 4px;
    border: 1px solid #ddd;
    background: #fff;
    color: #555
}

.btn-nudge:hover {
    background: var(--primary-color);
    color: #fff;
    border-color: var(--primary-color)
}

.btn-preview-slice {
    background: #6c757d;
    color: #fff;
    border: 1px solid #6c757d;
    width: 22px;
    height: 22px;
    padding: 0;
    font-size: 12px;
    line-height: 1;
    border-radius: 4px;
    margin-right: 4px
}

.btn-preview-slice:hover {
    background: #5a6268;
    transform: scale(1.1)
}

#slicePreviewModal .modal-content {
    background-color: #1a1a1a;
    color: #e0e0e0;
    border: 1px solid #333
}

#slicePreviewModal .modal-header {
    border-bottom-color: #333
}

#slicePreviewModal .modal-footer {
    border-top-color: #333
}

#slicePreviewModal .btn-close {
    filter: invert(1)
}

#slicePreviewImgContainer {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 300px;
    background-image: linear-gradient(45deg,#2a2a2a 25%,transparent 0),linear-gradient(-45deg,#2a2a2a 25%,transparent 0),linear-gradient(45deg,transparent 75%,#2a2a2a 0),linear-gradient(-45deg,transparent 75%,#2a2a2a 0);
    background-size: 20px 20px;
    background-position: 0 0,0 10px,10px -10px,-10px 0;
    border-radius: 4px;
    overflow: hidden
}

#slicePreviewImg {
    max-width: 100%;
    max-height: 60vh;
    box-shadow: 0 0 20px rgba(0,0,0,.5)
}

#modalNudgeTools .btn-nudge {
    width: 30px;
    height: 30px;
    font-size: 14px
}

.btn-single-dl {
    position: absolute;
    bottom: 35px;
    right: 5px;
    background: hsla(0,0%,100%,.9);
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-color);
    border: 1px solid #ddd;
    z-index: 2;
    opacity: 0;
    transition: opacity .2s
}

.btn-single-dl:hover {
    background: var(--primary-color);
    color: #fff;
    border-color: var(--primary-color)
}

.slice-card:hover .btn-single-dl {
    opacity: 1
}

footer {
    margin-top: auto;
    padding: 20px 0;
    text-align: center;
    color: var(--text-color);
    font-size: .9rem;
    background-color: var(--card-bg);
    border-top: 1px solid rgba(0,0,0,.05)
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: hsla(0,0%,100%,.8);
    z-index: 5;
    display: none;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(2px)
}


/* --- 针对“线条粗细”和“容差值”的强力样式覆盖 --- */

/* 1. 针对 Webkit 内核浏览器 (Chrome, Edge, Safari) */
#inputGridWeight::-webkit-slider-thumb,
#inputTolerance::-webkit-slider-thumb {
    -webkit-appearance: none; /* 移除默认外观 */
    appearance: none;
    background-color: #555555 !important; /* 滑块圆点：黑色 */
    border: 2px solid #555555 !important; /* 边框：黑色 */
    box-shadow: none !important; /* 去掉阴影 */
}

#inputGridWeight::-webkit-slider-runnable-track,
#inputTolerance::-webkit-slider-runnable-track {
    background-color: #d6d6d6 !important; /* 轨道底色：深灰色 */
}

/* 2. 针对 Firefox 浏览器 */
#inputGridWeight::-moz-range-thumb,
#inputTolerance::-moz-range-thumb {
    background-color: #555555 !important;
    border: none !important;
}

#inputGridWeight::-moz-range-track,
#inputTolerance::-moz-range-track {
    background-color: #d6d6d6 !important;
}

/* 3. 针对 IE/Edge 旧版 */
#inputGridWeight::-ms-thumb,
#inputTolerance::-ms-thumb {
    background-color: #555555 !important;
}

/* 4. 关键：处理点击时的光晕颜色（Focus Ring） */
/* 防止点击时出现原来的蓝色或粉色光晕，改为灰色光晕 */
#inputGridWeight:focus,
#inputTolerance:focus {
    border-color: #555555 !important;
    box-shadow: 0 0 0 0.25rem rgba(85, 85, 85, 0.25) !important;
    background-image: none !important; /* 移除 Bootstrap 可能残留的背景图 */
}

/* 5. 再次强制使用 accent-color 以防万一（现代浏览器支持） */
#inputGridWeight,
#inputTolerance {
    accent-color: #555555 !important;
    color: #555555 !important;
}



/* =========================================
         赛博朋克 (Cyber) 主题专属修复
   ========================================= */

/* 1. 修复字体颜色看不清的问题 */
/* 强制将 "text-muted" (原本的灰色) 改为主题色 (青色)，并稍微降低透明度 */
[data-theme="cyber"] .text-muted {
    color: var(--text-color) !important; 
    opacity: 0.9;
}

/* 2. 修复大面积白色背景块的问题 */
/* 将 .bg-light (原本的白色) 改为深色半透明背景，并加上赛博风边框 */
[data-theme="cyber"] .bg-light {
    background-color: rgba(0, 0, 0, 0.3) !important; /* 深黑色背景 */
    border: 1px solid rgba(0, 255, 204, 0.2) !important; /* 青色微光边框 */
    color: var(--text-color) !important;
}

/* 3. (可选) 优化输入框旁边的文字背景 (如 "行"、"列"、"宽"、"高") */
[data-theme="cyber"] .input-group-text {
    background-color: rgba(0, 255, 204, 0.1) !important;
    color: var(--text-color) !important;
    border-color: rgba(0, 255, 204, 0.3) !important;
}

/* 4. (可选) 优化输入框本身的背景，避免太白 */
[data-theme="cyber"] .form-control, 
[data-theme="cyber"] .form-select {
    background-color: rgba(0, 0, 0, 0.5) !important;
    color: var(--text-color) !important;
    border-color: rgba(0, 255, 204, 0.3) !important;
}
/* 修复输入框占位符颜色 */
[data-theme="cyber"] .form-control::placeholder {
    color: rgba(0, 255, 204, 0.5) !important;
}


/* =========================================
   手机端适配修复 (Mobile Responsive Fixes)
   ========================================= */
@media (max-width: 768px) {

    /* --- 1. 修复“切片结果”容器 --- */
    #previewGrid {
        /* 强制覆盖 JS 设置的固定列数 */
        /* 手机端改为 2 列显示，这样图片够大且不会溢出 */
        grid-template-columns: repeat(2, 1fr) !important; 
        gap: 8px !important;
    }

    /* 调整卡片内边距，节省空间 */
    .slice-card {
        padding: 5px !important;
    }

    /* --- 2. 修复“切片预览与微调”弹窗底部 --- */
    /* 将底部栏改为垂直排列，防止挤压 */
    #slicePreviewModal .modal-footer {
        flex-direction: column !important; 
        height: auto !important;
        padding: 15px 10px !important;
        gap: 15px;
    }

    /* (左侧) 信息统计块：改为居中横向排列 */
    #slicePreviewModal .modal-footer > div.text-start {
        padding-left: 0 !important;
        width: 100%;
        text-align: center !important;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        min-width: auto !important;
    }
    /* 让原本竖排的文字在一行显示 */
    #slicePreviewModal .modal-footer > div.text-start > div {
        display: inline-block;
        margin-bottom: 0;
    }

    /* (中间) 缩放控件：取消绝对定位，让它流式排布 */
    #slicePreviewModal .modal-footer > div.position-absolute {
        position: static !important; /* 关键：取消绝对定位 */
        transform: none !important;
        margin: 0 !important;
        width: 100%;
        display: flex;
        justify-content: center;
    }

    /* (右侧) 设置滑块：宽度占满并居中 */
    #slicePreviewModal .modal-footer > div.d-flex.flex-column {
        padding-right: 0 !important;
        width: 100%;
        align-items: center !important;
        min-width: auto !important;
    }

    /* 调整具体设置行的对齐方式 */
    #slicePreviewModal .modal-footer .d-flex.align-items-center.justify-content-end {
        justify-content: center !important;
        width: 100% !important;
    }
    
    /* 增加滑块区域的点击面积 */
    #slicePreviewModal .form-range {
        width: 50% !important; /* 稍微加宽滑块 */
    }
    
    /* 修复弹窗内图片容器的高度，避免手机上太高 */
    #slicePreviewImgContainer {
        height: 40vh !important; 
    }
}
